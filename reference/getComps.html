<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Aggregate length, age, or age-at-length composition data by strata — getComps • PacFIN.Utilities</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate length, age, or age-at-length composition data by strata — getComps"><meta property="og:description" content="getComps() first sets up the local environment, then runs
getcomps_long(), and finally returns the results of getcomps_long(),
which calculates summaries by groupings. getcomps_long() was developed to
make use of tidyverse but it still produces all of the old output. In the
future, this function will be replaced by code that can summarize both
survey data or commercial data. Until then, this is the best we can do and
it mimics old output such that legacy code will not break. You can and
should pass arguments to getcomps_long() using pass through arguments in
your call to getComps(), i.e., ..., especially when calculating
composition data related to age. See the input arguments for more details."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PacFIN.Utilities</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate length, age, or age-at-length composition data by strata</h1>
    
    <div class="hidden name"><code>getComps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>getComps()</code> first sets up the local environment, then runs
<code>getcomps_long()</code>, and finally returns the results of <code>getcomps_long()</code>,
which calculates summaries by groupings. <code>getcomps_long()</code> was developed to
make use of tidyverse but it still produces all of the old output. In the
future, this function will be replaced by code that can summarize both
survey data or commercial data. Until then, this is the best we can do and
it mimics old output such that legacy code will not break. You can and
should pass arguments to <code>getcomps_long()</code> using pass through arguments in
your call to <code>getComps()</code>, i.e., <code>...</code>, especially when calculating
composition data related to age. See the input arguments for more details.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getComps</span><span class="op">(</span></span>
<span>  <span class="va">Pdata</span>,</span>
<span>  strat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Comps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAL"</span>, <span class="st">"LEN"</span>, <span class="st">"AGE"</span><span class="op">)</span>,</span>
<span>  defaults <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fleet"</span>, <span class="st">"fishyr"</span>, <span class="st">"season"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">getcomps_long</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">towstrat</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  towid <span class="op">=</span> <span class="st">"SAMPLE_NO"</span>,</span>
<span>  weightid <span class="op">=</span> <span class="st">"Final_Sample_Size_L"</span>,</span>
<span>  dropmissing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Pdata</dt>
<dd><p>A data frame of biological samples
originating from the
Pacific Fishieries Information Network (PacFIN) data warehouse,
which originated in 2014. Data are pulled using sql calls, see
<code><a href="PullBDS.PacFIN.html">PullBDS.PacFIN</a>()</code>.</p></dd>


<dt>strat</dt>
<dd><p>A vector of column names to stratify the output over. For
example, if you wish to summarize by ageing method, then the argument
would look like <code>strat = "agemethod"</code> or, if you want to look at fleets
and gear, <code>strat = c("fleet", "usegear")</code>.</p></dd>


<dt>Comps</dt>
<dd><p>The type of composition data to create. See the function call
for the available options. The first option listed is the default, which
creates conditional age-at-length compositions by adding both <code>lengthcm</code>
and <code>Age</code> to the grouping structure.</p></dd>


<dt>defaults</dt>
<dd><p>The default stratification columns which will typically be
left at their default value of <code>c("fleet", "fishyr", "season")</code>.</p></dd>


<dt>verbose</dt>
<dd><p>Is deprecated as of version 0.2.8. No information is printed
to the screen from this function.</p></dd>


<dt>...</dt>
<dd><p>Pass additional arguments to <code>getcomps_long()</code>, such as
<code>dropmissing = FALSE</code> where the default behavior is <code>dropmissing = TRUE</code>.
The most important argument to consider modifying is <code>getComps(weightid = "Final_Sample_Size_L")</code>, which will only be applicable to length data.
Instead of the default, you might want to weight each stratification by
the final sample sizes found for age data, i.e., <code>getComps(weightid = "Final_Sample_Size_A")</code>. You can pass <code>weightid</code> any column that exists in
<code>Pdata</code>. Legacy code required you to set <code>Final_Sample_Size</code> outside of a
function call with something like <code>Pdata$Final_Sample_Size = Pdata$Expansion_Factor_1 * Pdata$Expansion_Factor_2</code> and all weighting was
done on the column called <code>"Final_Sample_Size"</code> but this is no longer the
case.</p></dd>


<dt>data</dt>
<dd><p>A data frame. The data frame must have the column names that
are specified for the next four input arguments, <code>towstrat</code>, <code>type</code>,
<code>towid</code>, and <code>weightid</code>.</p></dd>


<dt>towstrat</dt>
<dd><p>A vector of character values providing the column names for
which you want compositions for.</p></dd>


<dt>type</dt>
<dd><p>A character value specifying which category to summarize by,
i.e., <code>"length"</code> or <code>"Age"</code>.</p></dd>


<dt>towid</dt>
<dd><p>A vector of character values providing the column names that
generate a unique id for each sample.</p></dd>


<dt>weightid</dt>
<dd><p>A character value giving the column name that holds the
value to be summed for each type and strata.</p></dd>


<dt>dropmissing</dt>
<dd><p>A logical value supplied to the <code>drop</code> argument in
<code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">stats::aggregate()</a></code> that specifies whether or not to keep all levels in
the data even if there are no values to report for summaries.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A long data frame of weights for each grouping structure. Columns
identifying the grouping structures will come first, followed by columns
with sample sizes per group by sex category. The documentation for these
sample size columns is sparse because this function is set to be deprecated
next cycle and replaced with a simplified path to writing composition data.
But, information is present for males (sometimes abbreviated with an m),
females (sometimes abbreviated with an f), unsexed (sometimes abbreviated
with a u), and sexed (noted as both or b) records. If no sex is provided
then it is assumed all are unsexed and will be returned as such.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses the expansions created in <code><a href="getExpansion_1.html">getExpansion_1()</a></code> and
<code><a href="getExpansion_2.html">getExpansion_2()</a></code> using <code>"weightid"</code>. Thus, whatever column name is passed
to <code>weightid</code> will be used as the weight for each group. See the
documentation for the pass-through arguments, i.e., <code>...</code></p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>getcomps_long()</code>: The actual workhorse behind <code>getComps()</code>.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p><code><a href="getExpansion_2.html">getExpansion_2()</a></code> should be run before this function.</p></li>
<li><p><code><a href="writeComps.html">writeComps()</a></code> can be run on the output from this function.</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Andi Stephens, Kelli F. Johnson</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kelli F. Johnson, Chantel R. Wetzel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

