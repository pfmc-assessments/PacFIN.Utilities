<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working through sablefish PacFIN data • PacFIN.Utilities</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working through sablefish PacFIN data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PacFIN.Utilities</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sablefish_example.html">Working through sablefish PacFIN data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working through sablefish PacFIN data</h1>
                        <h4 data-toc-skip class="author">Kelli F.
Johnson</h4>
            
      

      <div class="hidden name"><code>sablefish_example.Rmd</code></div>

    </div>

    
    
<p>Working through PacFIN data can be complex. This examples guides you
through working up the data for sablefish. The fish ticket data contains
information on catches and is labeled <code>catch.pacfin</code> within
this vignette. The biological data that contains information on lengths
and ages is labeled <code>bds.pacfin</code>. These names are standard
for every data set that is downloaded and saved from PacFIN using
<code>PacFIN.Utilities</code> extraction code.</p>
<p>Before working up any of the data, a few items need to be clarified.
Such as what gear types you would like to use and what bins should be
used for the biological data. As well as which files you would like to
load.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Species common name based on NWFSC survey data</span></span>
<span><span class="va">common_name</span> <span class="op">&lt;-</span> <span class="st">"sablefish"</span></span>
<span><span class="co"># PacFIN species code</span></span>
<span><span class="va">species_code</span> <span class="op">&lt;-</span> <span class="st">"SABL"</span></span>
<span></span>
<span><span class="co"># Files</span></span>
<span><span class="va">file_bds</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">".."</span>, <span class="st">"PacFIN.SABL.bds.11.Nov.2024.RData"</span><span class="op">)</span></span>
<span><span class="va">file_catch</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">".."</span>, <span class="st">"data_commercial_catch_expansions.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bins for biological data</span></span>
<span><span class="va">length_bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">age_bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gear codes</span></span>
<span><span class="va">used_gears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HKL"</span>, <span class="st">"POT"</span>, <span class="st">"TWL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The maximum quantile at which to cap all data expansions within getExpansion_1().</span></span>
<span><span class="va">expansion</span> <span class="op">&lt;-</span> <span class="fl">0.95</span></span></code></pre></div>
<p>Specify specific records to retain when running
<code><a href="../reference/cleanPacFIN.html">cleanPacFIN()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine what samples to retain or filter out when using cleanPacFIN()</span></span>
<span><span class="co"># Keep all alternate (A), fork (F), and unknown (U) length types based on</span></span>
<span><span class="co"># FISH_LENGTH_TYPE_CODE. This decision should be species-specific</span></span>
<span><span class="va">good_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"A"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="co"># Keep only random (R) samples based on SAMPLE_METHOD_CODE. Only random samples</span></span>
<span><span class="co"># should be retained unless specified by a state agency.</span></span>
<span><span class="va">good_methods</span> <span class="op">&lt;-</span> <span class="st">"R"</span></span>
<span><span class="co"># Keep commercial on-board (C), market (M), and blank samples based on SAMPLE_TYPE</span></span>
<span><span class="va">good_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"M"</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="co"># Keep data from all 3 states. This is the default.</span></span>
<span><span class="va">good_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WA"</span>, <span class="st">"OR"</span>, <span class="st">"CA"</span><span class="op">)</span></span>
<span><span class="co"># Keep only break and burn (B, BB), unknown (U), and blank (") age reads based</span></span>
<span><span class="co"># on AGE_METHOD. This decision should be species-specific.</span></span>
<span><span class="va">good_age_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"BB"</span>, <span class="st">"U"</span>, <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Load the PacFIN biological data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># bds.pacfin</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">file_bds</span><span class="op">)</span></span>
<span><span class="co"># pre-processed catch data by year, state, and geargroup</span></span>
<span><span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file_catch</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="calculate-the-weightlength-relationship">Calculate the weight–length relationship<a class="anchor" aria-label="anchor" href="#calculate-the-weightlength-relationship"></a>
</h2>
<p>A choice must be made about which data set you want to fit for
estimating the weight–length relationships by sex and across sexes. Many
scientists choose to use the survey data because it is thought to best
represent the population. You could use the data retrieved from PacFIN
to calculate this relationship but that option is not shown here.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pull survey data</span></span>
<span><span class="va">bds_survey</span> <span class="op">&lt;-</span> <span class="fu">nwfscSurvey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nwfscSurvey/man/pull_bio.html" class="external-link">pull_bio</a></span><span class="op">(</span></span>
<span>  common_name <span class="op">=</span> <span class="va">common_name</span>,</span>
<span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Estimate weight-length relationship by sex</span></span>
<span><span class="va">weight_length_estimates</span> <span class="op">&lt;-</span> <span class="fu">nwfscSurvey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nwfscSurvey/man/estimate_weight_length.html" class="external-link">estimate_weight_length</a></span><span class="op">(</span></span>
<span>  <span class="va">bds_survey</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">weight_length_estimates</span>, <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="right">median_intercept</th>
<th align="right">SD</th>
<th align="right">A</th>
<th align="right">B</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">female</td>
<td align="right">3.4e-06</td>
<td align="right">0.0950741</td>
<td align="right">3.4e-06</td>
<td align="right">3.264309</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">3.7e-06</td>
<td align="right">0.1077196</td>
<td align="right">3.7e-06</td>
<td align="right">3.246560</td>
</tr>
<tr class="odd">
<td align="left">all</td>
<td align="right">3.8e-06</td>
<td align="right">0.1030400</td>
<td align="right">3.8e-06</td>
<td align="right">3.237330</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="catch-data">Catch data<a class="anchor" aria-label="anchor" href="#catch-data"></a>
</h2>
<p>The catch data must be summarized because it will be used in the
second stage expansion of the biological data. Where,
<code><a href="../reference/formatCatch.html">formatCatch()</a></code> takes a long data frame as input and converts
it to a wide data frame with one row per year and one column per catch
group. In the sablefish example the catch is stratified by
<code>state</code> and <code>geargroup</code>, leading to one column for
each state-gear combination. Catches can be summarized in pounds of
metric tons where the units should be explicitly passed to
<code><a href="../reference/getExpansion_2.html">getExpansion_2()</a></code> to convert the catches to pounds if
necessary.</p>
<p>It is recommended to pass a pre-processed long format catch file to
<code><a href="../reference/formatCatch.html">formatCatch()</a></code> that includes data stratified by state, gear
(e.g., expected name of geargroup), year (e.g., can use yr, year,
landing_year, or sample_year), and catch values. Depending upon the
species biological data in PacFIN can be present before the start of
PacFIN catch records (1981), hence, catch amounts from historical
reconstructions may be necessary to ensure proper expansion.
Additionally, the stratification should always include areas (e.g.,
state or areas within states) even if using coastwide fleets in the
model due to variable catch and sampling by areas.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catch_formatted</span> <span class="op">&lt;-</span> <span class="va">catch</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/formatCatch.html">formatCatch</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"geargroup"</span><span class="op">)</span>,</span>
<span>    valuename <span class="op">=</span> <span class="st">"catch_mt"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="biological-data">Biological data<a class="anchor" aria-label="anchor" href="#biological-data"></a>
</h2>
<p>The biological data must first be cleaned using
<code><a href="../reference/cleanPacFIN.html">cleanPacFIN()</a></code>. Here, we choose to remove the rows of data
that should not be used in the assessment by choosing
<code>CLEAN = TRUE</code> but you can change that to <code>FALSE</code>
and all rows will be saved. We also create an additional column that
matches records to the same stratification used for the catch data above
for weighting.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bds_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cleanPacFIN.html">cleanPacFIN</a></span><span class="op">(</span></span>
<span>  Pdata <span class="op">=</span> <span class="va">bds.pacfin</span>,</span>
<span>  keep_gears <span class="op">=</span> <span class="va">used_gears</span>,</span>
<span>  CLEAN <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  keep_age_method <span class="op">=</span> <span class="va">good_age_method</span>,</span>
<span>  keep_sample_type <span class="op">=</span> <span class="va">good_samples</span>,</span>
<span>  keep_sample_method <span class="op">=</span> <span class="va">good_methods</span>,</span>
<span>  keep_length_type <span class="op">=</span> <span class="va">good_lengths</span>,</span>
<span>  keep_states <span class="op">=</span> <span class="va">good_states</span>,</span>
<span>  spp <span class="op">=</span> <span class="va">common_name</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    stratification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">geargroup</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If the model is going to include both length and marginal ages, one
needs to consider how to avoid double-use of the data (e.g., marginal
ages are not conditioned on the length and are considered indepented of
the lengths in the model). Historically, two common approaches have been
used to handle this. The first approach is to apply a lambda to the
lengths and ages from the same fleet in the model. The second approach
is to not use the lengths for any fish with an age that will be used in
the model which is shown below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bds_cleaned</span> <span class="op">&lt;-</span> <span class="va">bds_cleaned</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Set any length with an age to NA to avoid double use of data</span></span>
<span>    <span class="co"># in the model via marginals.</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      lengthcm <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span> <span class="op">~</span> <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span> <span class="op">~</span> <span class="va">lengthcm</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/cleanPacFIN.html">cleanPacFIN()</a></code> filters out data and adds additional
columns that are used in the data processing. One of the columns added,
<code>fleet</code>, is used to separate the data by model fleet. The
default values in <code>fleet</code> are set to the gear names defined
by <code>keep_gears</code> in <code><a href="../reference/cleanPacFIN.html">cleanPacFIN()</a></code>. The values in
this column should be modified by the user, if necessary.</p>
<p>A new function, <code><a href="../reference/get_pacfin_expansions.html">get_pacfin_expansions()</a></code>, has been added
in the package that does both the first- and second-stage expansions
(<code><a href="../reference/getExpansion_1.html">getExpansion_1()</a></code> and <code><a href="../reference/getExpansion_2.html">getExpansion_2()</a></code>) in a
single call. This function also returns the product of the first-stage
and second-stage expansion. Previously, users had to multiply the
<code>Expansion_Factor_1_L</code> or <code>Expansion_Factor_1_A</code>
and <code>Expansion_Factor_2</code> columns external to the expansion
functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expanded_comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pacfin_expansions.html">get_pacfin_expansions</a></span><span class="op">(</span></span>
<span>  Pdata <span class="op">=</span> <span class="va">bds_cleaned</span>,</span>
<span>  Catch <span class="op">=</span> <span class="va">catch_formatted</span>,</span>
<span>  weight_length_estimates <span class="op">=</span> <span class="va">weight_length_estimates</span>,</span>
<span>  Units <span class="op">=</span> <span class="st">"MT"</span>,</span>
<span>  maxExp <span class="op">=</span> <span class="va">expansion</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  savedir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Create the length composition data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_comps_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getComps.html">getComps</a></span><span class="op">(</span></span>
<span>  Pdata <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">expanded_comps</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lengthcm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Comps <span class="op">=</span> <span class="st">"LEN"</span>,</span>
<span>  weightid <span class="op">=</span> <span class="st">"Final_Sample_Size_L"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">length_composition_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/writeComps.html">writeComps</a></span><span class="op">(</span></span>
<span>  inComps <span class="op">=</span> <span class="va">length_comps_long</span>,</span>
<span>  fname <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{species_code}_lcomps_{min(length_bins)}-{max(length_bins)}.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  comp_bins <span class="op">=</span> <span class="va">length_bins</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Create the age composition data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_comps_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getComps.html">getComps</a></span><span class="op">(</span></span>
<span>  Pdata <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">expanded_comps</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Comps <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>  weightid <span class="op">=</span> <span class="st">"Final_Sample_Size_A"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">age_composition_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/writeComps.html">writeComps</a></span><span class="op">(</span></span>
<span>  inComps <span class="op">=</span> <span class="va">age_comps_long</span>,</span>
<span>  fname <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{species_code}_acomps_{min(age_bins)}-{max(age_bins)}.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  comp_bins <span class="op">=</span> <span class="va">age_bins</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kelli F. Johnson, Chantel R. Wetzel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
